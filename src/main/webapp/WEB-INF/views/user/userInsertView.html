
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>회원가입</title>

<link rel="shortcut icon"
	href="/resources/bootstrap/HTML/images/favicon.ico" />
<link
	href='https://fonts.googleapis.com/css?family=Lato:400,300,700&amp;subset=latin,latin-ext'
	rel='stylesheet' type='text/css'>
<link rel="stylesheet" type="text/css"
	href="/resources/bootstrap/HTML/bootstrap/css/bootstrap.min.css" />
<link rel="stylesheet" type="text/css"
	href="/resources/bootstrap/HTML/css/animate.css" />
<link rel="stylesheet" type="text/css"
	href="/resources/bootstrap/HTML/css/font-awesome.min.css" />
<link rel="stylesheet" type="text/css"
	href="/resources/bootstrap/HTML/css/swiper.min.css" />
<link rel="stylesheet" type="text/css"
	href="/resources/bootstrap/HTML/css/style.css" />
<script src="/resources/bootstrap/HTML/javascript/pace.min.js"></script>
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="/resources/bootstrap/HTML/bootstrap/js/bootstrap.min.js"></script>
<script src="/resources/bootstrap/HTML/javascript/modernizr-custom.js"></script>
<script src="/resources/bootstrap/HTML/javascript/script.js"></script>
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

<script src="/resources/js/user/user.js"></script>
<script src="/resources/js/user/userController.js"></script>
<script src="/resources/js/homepage/homepageController.js"></script>

</head>
<script>
<!-- 회원가입 이벤트 핸들링 -->
	$(document).ready(function() {

		var userController = new UserController();
		var nicknameCheckSuccess = false;
		var emailCheckSuccess = false;

		// 취소 버튼
		$('#cancel').click(function() {

			var homepageController = new HomepageController;
			homepageController.requestLoginUrl();
			
		});

		// 회원가입 버튼 
		$('#join').click(function() {

			var status = checkValue(); // 입력한 상황 체크
			if (status) {
				var id = $('#id').val();
				var pw = $('#pw').val();
				var nickname = $('#nickname').val();
				var phoneNum = $('#phoneNum_1').val() + $('#phoneNum_2').val() + $('#phoneNum_3').val();
				var newUser = new User(id, pw, nickname, phoneNum);
				var isSuccess = userController.requestUserInsert(newUser);
				
				if (isSuccess === "success") {
					alert("회원가입 성공");
					var homepageController = new HomepageController;
					homepageController.requestLoginUrl();
				} else {
					alert("회원가입 실패");
				}
				
			}

		});
		// 이메일 인증 유효성 검사
		function checkEmail() {

			var idChk = /([\w-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/; // 이메일
			var id = $("#id").val();

			if (!$("#id").val()) {
				alert("이메일을 입력해주세요.");
				$("#id").focus();
				return false;
			}

			if (!idChk.test(id)) {
				alert("이메일 주소가 유효하지 않습니다.");
				$("#id").focus();
				return false;
			}

			if ($("#id").val().length < 6) {
				alert("이메일은 6자리 이상 입력해주세요");
				$("#id").focus();
				return false;
			}

			return true;
		}

		// 회원가입시 유효성 검사
		function checkValue() {

			var chk1 = /[0-9]{1}/; //숫자만 입력
			var chk2 = /[a-zA-Z]{1}/; //문자만 입력
			var chk3 = /[~!@#$%^&*()_+|<>?{}]{1}/; //특수문자
			var chk4 = /[\s]/; // 공백

			var pw = $("#pw").val();

			if (!$("#id").val()) {
				alert("이메일을 입력해주세요.");
				$("#id").focus();
				return false;
			}

			if (!emailCheckSuccess) {
				alert("이메일 인증을 해주세요.");
				$("#email_confirm").focus();
				return false;
			}

			if (!$("#nickname").val()) {
				alert("닉네임을 입력해주세요.");
				$("#nickname").focus();
				return false;
			}

			if (!nicknameCheckSuccess) {
				alert("닉네임 중복확인을 해주세요");
				$("#nickname").focus();
				return false;
			}

			if (!$("#pw").val()) {
				alert("비밀번호를 입력해주세요.");
				$("#pw").focus();
				return false;
			}

			// 비밀번호와 비밀번호 확인에 입력된 값이 동일한지 확인
			if ($("#pw").val() != $("#pw_check").val()) {
				$("#pw_check").focus();
				alert("비밀번호를 동일하게 입력해주세요.");
				return false;
			}
			if ($("#pw").val().length < 6 || (nickname.length > 12)) {
				alert("비밀번호를 6~12자리로 입력해주세요.");
				$("#pw").focus();
				return false;
			}

			if ($('#phoneNum_2').val().length > 4 || chk4.test($('#phoneNum_2').val())) {
				alert("전화번호를 올바르게 입력해주세요.");
				$("#phoneNum_2").focus();
				return false;
			}

			if ($('#phoneNum_3').val().length > 4 || chk4.test($('#phoneNum_3').val())) {
				alert("전화번호를 올바르게 입력해주세요.");
				$("#phoneNum_3").focus();
				return false;
			}

			if(chk4.test(pw)){
				alert("비밀번호에 공백은 들어갈 수 없습니다.");
				$("#pw").focus();
				return false;
			}
			
			if ((chk1.test(pw) && chk2.test(pw)) || chk3.test(pw)) {
				return true;
			} else {
				alert("비밀번호는 문자, 숫자의 조합으로 입력해주세요.(특수문자 가능)");
				$("#pw").focus();
				return false;
			}

			return true;
		}

		// 닉네임 중복확인
		$('#nickname_check').click(function() {
			var nickname = $('#nickname').val();
			var chkNick = /[~!@#$%^&*()_+|<>?{}]{1}/; //특수문자
			var chkNull = /[\s]/; // 공백

			if ((nickname.length < 2) || (nickname.length > 10)) {
				alert("닉네임은 2~10글자 사이로 입력해 주세요");
				$('#nickname').focus();
			} else if (chkNick.test(nickname) || chkNull.test(nickname)) {
				alert("닉네임에 특수문자나 공백은 들어갈 수 없습니다.");
				$('#nickname').focus();
			} else {
				nicknameCheckSuccess = userController.requestNicknameCheck(nickname);
				if (!nicknameCheckSuccess) {
					$('#nickname').focus();
				}
			}
		});

		var emailSendSuccess = false;
		var certificationNum;

		// 이메일 인증번호 발송	
		$('#email_send').click(function() {

			var status = checkEmail(); // 이메일 유효성 검사 

			if (status) {
				// 				$("#email_alert").show();
				certificationNum = parseInt(Math.random() * 1000000);
				var email = $('#id').val();
				alert("인증번호 : " + certificationNum);
				emailSendSuccess = userController.requestEmailSend(email, certificationNum);
				// 				$("#email_alert").hide();
			}
		});

		// 이메일 인증
		$("#email_check").click(function() {

			if (emailSendSuccess) { // 인증번호를 전송한 상태
				var userInputNum = $('#email_confirm').val();

				if (userInputNum == certificationNum) {
					alert("이메일 인증에 성공하였습니다.");
					$('#email_confirm').attr("readonly", "readonly");
					$('#email_check').attr("readonly", "readonly");
					emailCheckSuccess = true;
				} else {
					alert("인증번호를 올바르게 입력해주세요.");
					$('#email_confirm').focus();
				}
			} else {
				alert("인증번호 전송을 먼저 수행하십시오.");
			}
		});

	});
</script>

<style>
@font-face {
	font-family: 'baemin';
	src: url(/resources/customize/fonts/배달의민족주아체.ttf) format('truetype');
}

button, h2, a, input, label, select{
	font-family: 'baemin';
}

#join, #cancel {
	width: 100%;
}

#email_send, #nickname_check, #email_check {
	height: 37px;
}
</style>


<body>

	<div class="container">
		<div class="row">
			<div class="col-lg-8 col-lg-offset-2 col-md-12">
				<article class="content">

					<section>
						<h2>회원 가입</h2>
						<div id="contact_form" class="form-horizontal">
							<!-- 아이디(이메일) -->
							<div class="form-group">
								<label class="col-sm-3 control-label"><span
									style="color: red;">* </span>아이디(E-mail)</label>
								<div class="col-sm-6 animated-form-control">
									<input placeholder="E-mail" type="text" name="name"
										class="text form-control" id="id" required="required"
										aria-required="true" />
								</div>
								<div class="col-sm-1 ">
									<button id="email_send" class="btn btn-primary ">인증요청</button>
								</div>
							</div>
							<!-- 인증번호  -->
							<div class="form-group">
								<label class="col-sm-3 control-label"><span
									style="color: red;">* </span>인증번호</label>
								<div class="col-sm-6 animated-form-control">
									<input placeholder="Confirm Number" type="text" name="name"
										class="text form-control" id="email_confirm"
										required="required" aria-required="true" />
								</div>
								<div class="col-sm-1 ">
									<button id="email_check" class="btn btn-primary ">인증확인</button>
								</div>
							</div>
							<!-- 닉네임 -->
							<div class="form-group">
								<label class="col-sm-3 control-label"><span
									style="color: red;">* </span>닉네임</label>
								<div class="col-sm-6 animated-form-control">
									<input placeholder="Nickname" id="nickname" type="text"
										name="email" class="text form-control" required="required" />
								</div>
								<div class="col-sm-1 ">
									<button id="nickname_check" class="btn btn-primary ">중복확인</button>
								</div>
							</div>
							<!-- 비밀번호 -->
							<div class="form-group">
								<label class="col-sm-3 control-label"><span
									style="color: red;">* </span>비밀번호</label>
								<div class="col-sm-6 animated-form-control">
									<input placeholder="Password " id="pw" type="password"
										name="email" class="text form-control" required="required" />
								</div>
							</div>
							<!-- 비밀번호 확인 -->
							<div class="form-group">
								<label class="col-sm-3 control-label"><span
									style="color: red;">* </span>비밀번호 확인</label>
								<div class="col-sm-6 animated-form-control">
									<input placeholder="Password Check" id="pw_check"
										type="password" name="email" class="text form-control"
										required="required" />
								</div>
							</div>

							<div class="form-group" style="line-height: 0;">
								<div class="col-sm-3"></div>
								<div class="col-sm-9">
									<span style="font-size: 12px;">비밀번호는 공백없이 문자, 숫자를 조합하여
										입력 가능 (6~12자리, 특수문자 가능)</span>
								</div>
							</div>

							<!-- 전화번호 -->
							<div class="form-group">
								<label class="col-sm-3 control-label">전화번호</label>

								<div class="col-sm-2 ">
									<select id="phoneNum_1" class="text form-control">
										<option>010</option>
										<option>019</option>
										<option>011</option>
									</select>
								</div>

								<div class="col-sm-2 animated-form-control">
									<input id="phoneNum_2" class="text form-control">
								</div>

								<div class="col-sm-2 animated-form-control">
									<input id="phoneNum_3" class="text form-control">
								</div>
							</div>

							<!-- 가입하기 / 취소 버튼 -->
							<div class="form-group">
								<div class="col-sm-3"></div>
								<div class="col-sm-3 animated-form-control">
									<button id="join" class="col-sm-3 btn btn-primary">가입하기</button>
								</div>
								<div class="col-sm-3 animated-form-control">
									<button id="cancel" class="btn btn-primary">취 소</button>
								</div>
							</div>
						</div>
					</section>
				</article>
			</div>
		</div>
	</div>



</body>
</html>