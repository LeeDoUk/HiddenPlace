<!DOCTYPE html>
<html>
<head>
<title>내알못</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="../../../resources/js/user/user.js"></script>
<script src="../../../resources/js/user/userController.js"></script>


<style>
/* 공통 적용 */
a {
	/* a 태그 링크 밑줄 제거 */
	text-decoration: none !important;
}

/* 상단 로그인 바 */
#login_button {
	margin-top: 4%;
}

#login_button>button {
	border: 0;
	outline: 0;
	background-color: white;
}

/*상단 메인 메뉴 바*/
#logo_img {
	width: 170px;
}

#main_buttons {
	margin: 3% 10% 0 10%;
}

#main_buttons>a {
	font-size: 120%;
	border: 0;
	outline: 0;
	width: 120%;
}

/*메인 사진 박스*/
#main_img {
	width: 100%;
	height: 400px;
	opacity: 1.0;
}

.main_img_text {
	position: absolute;
	min-width: 80%;
	text-align: center;
	top: 350px;
	left: 50%;
	transform: translate(-50%, -50%);
	/*font-size: 18px;*/
}

.main_img_text>h2 {
	font-weight: bold;
	color: white;
	font-family: font-style : italic;
}

/* 검색 바 */
.span12 {
	position: relative;
	top: -50px;
	left: 30%;
	transform: translate(-50%, -50%);
}

.glyphicon-search {
	width: 60px;
	height: 60px;
}

.icon-search {
	background-color: transparent;
	width: 100px;
}

#custom-search-form .search-query {
	-webkit-border-radius: 3px;
	-moz-border-radius: 3px;
	width: 600px;
	height: 40px;
	font-size: 20px;
}

#custom-search-form button {
	border: 0;
	background: none;
	/** belows styles are working good */
	padding: 2px 5px;
	margin-top: 2px;
	position: relative;
	left: -28px;
	/* IE7-8 doesn't have border-radius, so don't indent the padding */
	margin-bottom: 0;
	-webkit-border-radius: 3px;
	-moz-border-radius: 3px;
	background-color: transparent;
}

.search-query:focus+button {
	z-index: 3;
}

.text {
	position: absolute;
	top: 40px;
	left: 80px;
	width: 700%;
}

#row_margin {
	margin-bottom: 2%;
}

#row_margin_font {
	margin-top: 10%;
	margin-bottom: 5%;
}

#input_id_email {
	margin-left: -5%;
	margin-right: 5%;
}

#input_id_nickname {
	margin-left: 6%;
}

#input_button_insert {
	margin-top: 2%;
	margin-left: 8%;
}

#input_number {
	margin-left: 5%;
}

#boder_bottom {
	border-bottom: 1%;
}

#button_join {
	margin-top: 3%;
	margin-left: 5%;
	width: 100px;
	height: 30px;
	background: #3399ff;
	border: none;
}

#button_cancle {
	margin-top: 3%;
	margin-left: 5%;
	width: 100px;
	height: 30px;
	background: #3399ff;
	border: none;
}

#sign_up_border {
	margin-top: 0%;
	margin-bottom: 3%;
	border-top: 1px solid #3399ff;
}

#sign_up {
	margin-top: 4%;
	font-size: 30px;
	font-weight: bold;
	color: gray;
}

#email_send, #nickname_check, #email_check, #cancel, #join {
	background: #3399ff;
	color: white;
	border: none;
}

/* .col-sm-2> #cancel { */
/* 	margin-left: -70%; */
/* } */
</style>
</head>


<body>
	<!-- 상단 메인 메뉴 바 -->
	<div class="container">
		<div class="col-sm-3">
			<a href="homeView.html"><img id="logo_img" src="logo.png"></a>
		</div>
		<div class="col-sm-9">
			<div class="col-sm-9"></div>
			<div class="col-sm-3">
				<div id="login_button" class="btn-group">
					<button type="button" class="btn btn">로그인</button>
					<button type="button" class="btn btn">회원가입</button>
				</div>
			</div>
			<div class="col-sm-7">
				<div id="main_buttons" class="btn-group btn-group-justified">
					<a href="#" class="btn btn">홈페이지</a> <a href="#" class="btn btn">마이페이지</a>
					<a href="#" class="btn btn">나만의 루트</a> <a href="#" class="btn btn">즐겨찾기</a>
				</div>
			</div>
		</div>
	</div>

	<!-- 메인 사진 박스 -->
	<div class="container-fluid">
		<img id="main_img" src="jeju.jpg" alt="route">

		<div class="main_img_text">
			<h2>내가 알지 못한 멋진 곳이 궁금하신가요?</h2>
		</div>

		<div class="span12">
			<form id="custom-search-form"
				class="form-search form-horizontal pull-right">
				<div class="input-append span12">
					<input type="text" class="search-query"
						placeholder="                                          #내가 알지 못한 곳">
					<button type="submit" class="glyphicon glyphicon-search">
						<i class="icon-search icon-search-4x"></i>
					</button>
				</div>
			</form>
		</div>
	</div>
	<!--회원가입  -->
	<div class="form-horizontal">

		<div class="form-group">
			<!-- 회원가입상단 문구 -->
			<div id="sign_up">
				<div class="col-sm-2"></div>
				<h1>회원가입</h1>
			</div>
			<div class="col-sm-2"></div>
			<div id="sign_up_border" class="col-sm-8"></div>
			<div class="col-sm-2"></div>
			<br> <br>
		</div>
		<!-- 아이디 입력창-->
		<div class="form-group">
			<label class="col-sm-5 control-label" for="textinput"><span
				style="color: red;">* </span>아이디(이메일)</label>

			<div class="col-sm-3">
				<input id="id" name="textinput" type="text" placeholder="E-mail"
					class="form-control" />
			</div>

			<div class="col-sm-2">
				<button id="email_send" class="btn btn-success">인증요청</button>
			</div>
			<div class="col-sm-2"></div>
		</div>


		<!-- 인증번호입력창-->
		<div class="form-group">
			<label class="col-sm-5  control-label" for="textinput"><span
				style="color: red;">* </span>인증번호</label>
			<div class="col-sm-3">
				<input id="email_confirm" name="textinput" type="text"
					placeholder="check-Number" class="form-control input-md">
			</div>
			<div class="col-sm-2">
				<button id="email_check" class="btn btn-success">인증확인</button>
			</div>
		</div>


		<!-- 닉네임입력창-->
		<div class="form-group">
			<label class="col-sm-5  control-label" for="textinput"><span
				style="color: red;">* </span>닉네임</label>
			<div class="col-sm-2">
				<input id="nickname" name="textinput" type="text"
					placeholder="Nickname" class="form-control input-md">
			</div>
			<div class="col-sm-5">
				<button id="nickname_check" class="btn btn-success">중복확인</button>
			</div>
		</div>


		<!--비밀번호입력창-->
		<div class="form-group">
			<label class="col-sm-5  control-label" for="passwordinput"><span
				style="color: red;">* </span>비밀번호</label>
			<div class="col-sm-3">
				<input id="pw" name="passwordinput" type="password"
					placeholder="Password" class="form-control input-md">
			</div>
			<div class="col-sm-4"></div>
		</div>


		<!-- 비밀번호 확인 입력창-->
		<div class="form-group">
			<label class="col-sm-5  control-label" for="passwordinput"><span
				style="color: red;">* </span>비밀번호 확인</label>
			<div class="col-sm-3">
				<input id="pw_check" name="passwordinput" type="password"
					placeholder="Password-Check" class="form-control input-md">
			</div>
			<div class="col-sm-4"></div>
		</div>


		<!-- 전화번호 입력창 -->
		<div class="form-group">
			<label class="col-sm-5  control-label" for="year">전화번호</label>
			<div class="col-sm-1">
				<select id="phoneNum_1" class="form-control">
					<option>010</option>
					<option>019</option>
					<option>011</option>
				</select>
			</div>
			<div class="col-sm-1">
				<input id="phoneNum_2" size="6" type="password"
					class="form-control input-md">
			</div>
			<div class="col-sm-1">
				<input id="phoneNum_3" size="6" class="form-control input-md">
			</div>
		</div>
		<br>

		<!-- 하단버튼 -->
		<div class="form-group">
			<label class="col-sm-5  control-label" for="button1id"></label>
			<div class="col-sm-1">
				<button id="join" class="btn btn-success">가 입</button>
			</div>
			<div class="col-sm-2">
				<button id="cancel" class="btn btn-success">취 소</button>
			</div>
			<div class="col-sm-4"></div>
		</div>
		<br> <br>
		<div class="col-sm-2"></div>
		<div id="sign_up_border" class="col-sm-8"></div>
		<div class="col-sm-2"></div>
	</div>
</body>


<script>
<!-- 회원가입 이벤트 핸들링 -->
	$(document).ready(function() {

		var userController = new UserController();
		var nicknameCheckSuccess = false;
		var emailCheckSuccess = false;

		// 취소 버튼
		$('cancel').click(function() {

			location.href = "views/homepage/homeView"; // 메인 홈페이지 url

		});

		// 회원가입 버튼 
		$('#join').click(function() {

			var status = checkValue(); // 입력한 상황 체크
			if (status) {
				var id = $('#id').val();
				var pw = $('#pw').val();
				var nickname = $('#nickname').val();
				var phoneNum = $('#phoneNum_1').val() + $('#phoneNum_2').val() + $('#phoneNum_3').val();
				var newUser = new User(id, pw, nickname, phoneNum);
				userController.requestUserInsert(newUser);
			}

		});

		// 회원가입시 입력사항 확인
		function checkValue() {

			var idChk = /([\w-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/; // 이메일
			var pwChk = /^[a-zA-Z0-9]*$/; // 영어&숫자만

			var chk1 = /[0-9]{1}/; //숫자만 입력
			var chk2 = /[a-zA-Z]{1}/; //문자만 입력
			var chk3 = /[~!@#$%^&*()_+|<>?{}]{1}/; //특수문자

			var id = $("#id").val();
			var pw = $("#pw").val();

			if (!$("#id").val()) {
				alert("이메일을 입력해주세요.");
				$("#id").focus();
				return false;
			}

			if (!idChk.test(id)) {
				alert("이메일 주소가 유효하지 않습니다.");
				$("#id").focus();
				return false;
			}

			if ($("#id").val().length < 6) {
				alert("이메일은 6자리 이상 입력해주세요");
				$("#id").focus();
				return false;
			}

			if (!$("#nickname").val()) {
				alert("닉네임을 입력해주세요.");
				$("#nickname").focus();
				return false;
			}

			if (!nicknameCheckSuccess) {
				alert("닉네임 중복확인을 해주세요");
				$("#nickname").focus();
				return false;
			}

			if (!$("#pw").val()) {
				alert("비밀번호를 입력해주세요.");
				$("#pw").focus();
				return false;
			}

			if (!$("#pw_check").val()) {
				alert("비밀번호를 동일하게 입력해주세요.");
				$("#pw_check").focus();
				return false;
			}

			// 비밀번호와 비밀번호 확인에 입력된 값이 동일한지 확인
			if ($("#pw").val() != $("#pw_check").val()) {
				$("#pw_check").focus();
				alert("비밀번호를 동일하게 입력해주세요.");
				return false;
			}

			if ($("#pw").val().length < 6) {
				alert("비밀번호를 6자 이상 입력해주세요.");
				$("#pw").focus();
				return false;
			}

			if (!emailCheckSuccess) {
				alert("이메일 인증을 해주세요.");
				$("#email_confirm").focus();
				return false;
			}

			if (chk1.test(pw) && chk2.test(pw)) {
				return true;
			} else {
				alert("비밀번호를 문자, 숫자의 조합으로 입력해주세요.");
				$("#pw").focus();
				return false;
			}

			return true;
		}

		// 닉네임 중복확인
		$('#nickname_check').click(function() {
			var nickname = $('#nickname').val();
			var chkNick = /[~!@#$%^&*()_+|<>?{}]{1}/; //특수문자

			if ((nickname.length < 2) || (nickname.length > 10)) {
				alert("닉네임은 2~10글자 사이로 입력해 주세요");
				$('#nickname').focus();
			} else if (chkNick.test(nickname)) {
				alert("닉네임에 특수문자는 들어갈 수 없습니다.");
				$('#nickname').focus();
				$('#nickname').attr("value", "");
			} else {
				nicknameCheckSuccess = userController.requestNicknameCheck(nickname);
				alert(nicknameCheckSuccess);
			}
		});

		var emailSendSuccess = false;
		var certificationNum;

		// 이메일 인증번호 발송	
		$('#email_send').click(function() {
			$("#email_alert").show();
			certificationNum = parseInt(Math.random() * 1000000);
			var email = $('#id').val();

			emailSendSuccess = userController.requestEmailSend(email, certificationNum);
			$("#email_alert").hide();
		});
		// 이메일 인증번호 확인 
		$("#email_check").click(function() {
			if (emailSendSuccess) {
				var userInputNum = $('#email_confirm').val();

				emailCheckSuccess = userController.requestEmailCheck(userInputNum, certificationNum);
				$('#email_confirm').attr("readonly", "readonly");
				$('#email_check').attr("readonly", "readonly");

				// 			//$('#emailSend').attr("disabled", true);
				// 			//$('#emailCheckSuccess').attr("disabled", true);
				// 			$('#emailSend').attr("class", "btn disabled");
				// 			$('#emailCheckSuccess').attr("class", "btn disabled");
			} else {
				alert("인증번호 전송을 먼저 수행하십시오.");
			}
		});

	});

// 	// email 직접입력
// 	$(document).ready(function() {
// 		var email2 = $('#email2');
// 		var email1 = $('#email1');

// 		email2.bind('change', null, function() {

// 			var host = this.value; // email2.value

// 			if (host != 'etc' && host != '') { // 이메일
// 				email1.attr('readonly', true);
// 				email1.val(host).change();
// 			} else if (host == 'etc') { // 직접입력 선택시
// 				email1.attr('readonly', false);
// 				email1.val('').change();
// 				email1.focus();
// 			} else {
// 				email1.attr('readonly', true);
// 				email1.val('').change();
// 			}
// 		});
// 	});
</script>
</html>
